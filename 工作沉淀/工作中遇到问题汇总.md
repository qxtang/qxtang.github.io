# 工作中遇到问题汇总

Q：某个站点的 nginx 配置使用 location 前缀匹配，某些服务的前缀有相同部分，比如 /api-serve1、/api-serve2，流量转发到了后面的服务

A：前缀匹配命中后，会继续更长前缀匹配和正则匹配。可换成使用 ~ 来匹配，这是区分大小写的正则匹配，按顺序匹配，一旦匹配即停止后续匹配。

---

Q：小程序适配 iphonex 机型底部安全区域

A：padding-bottom: constant(safe-area-inset-bottom);

---

Q：小程序: hideLoading 能把 toast 也隐藏掉

A：  
https://developers.weixin.qq.com/community/develop/doc/00020212ec8200bc146731f2f51800
https://developers.weixin.qq.com/community/develop/doc/000008d41284382afbf6bdf6051c00

---

Q：css module 的局限性，无法准确预测类名

```less
// 例如这样的写法，使用了 css module 不会生效
.parent {
  color: red;
}

// 鼠标经过某个子节点想要修改父节点的样式
.children {
  &:hover .parent {
    color: yellow;
  }
}
```

Q：MySQL 数据库使用 utf8 编码格式 无法保存 emoji 表情

A：

- 改成 utf8mb4
- 是 MySQL 的一个历史遗留问题，utf8mb4 才是真正的 UTF-8
- 在 MySQL 中，“utf8”编码只支持每个字符最多三个字节，中文是占 3 个字节，其他数字、英文、符号占一个字节
- 而真正的 UTF-8 是每个字符最多四个字节，emoji 符号占 4 个字节，一些较复杂的文字、繁体字也是 4 个字节
- MySQL 一直没有修复这个 bug，他们在 2010 年发布了一个叫作“utf8mb4”的字符集，巧妙的绕过了这个问题

---

Q：IOS 无法通过 volume 属性设置 video 音量

A：https://developer.apple.com/library/archive/documentation/AudioVideo/Conceptual/Using_HTML5_Audio_Video/Device-SpecificConsiderations/Device-SpecificConsiderations.html

---

Q：小程序环境判断

- https://developers.weixin.qq.com/community/develop/doc/000e466b2c84d057b178e339d5b000
- https://developers.weixin.qq.com/community/develop/article/doc/000e6606ab4ac0edb4791eb4951013

---

Q：typescript 工程，编译产物每一个文件都产生多余辅助函数

A：https://www.typescriptlang.org/tsconfig#importHelpers

---

Q：rendering twice because of strict mode

A：https://stackoverflow.com/questions/61254372/my-react-component-is-rendering-twice-because-of-strict-mode

---

Q：useEffect hook, dom ref is null in unmount callback

A：

- https://github.com/facebook/react/issues/20875
- https://reactjs.org/blog/2020/08/10/react-v17-rc.html#effect-cleanup-timing

---

Q：H5 页面在 iphone 手机底部出现留白

A：
meta viewport，加入 viewport-fit=cover

```html
<meta
  name="viewport"
  content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0, viewport-fit=cover"
/>
```

---

Q：解决 Git 默认不区分文件名大小写的问题

A：

- https://www.jianshu.com/p/df0b0e8bcf9b

```sh
git config core.ignorecase false
```
